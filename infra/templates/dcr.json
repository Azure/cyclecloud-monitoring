{
  "properties": {
    "description": "EUS DCR with Prom/MAC + CustomVMScrapeConfig",
    "dataSources": {
      "prometheusForwarder": [
        {
          "name": "myPromDataSource1",
          "streams": [
            "Microsoft-PrometheusMetrics"
          ],
          "customVMScrapeConfig": {
            "global": {
              "scrape_interval": "15s",
              "evaluation_interval": "15s"
            },
            "scrape_configs": [
              {
                "job_name": "Microsoft-node_exporter",
                "scrape_interval": "15s",
                "static_configs": [
                  {
                    "targets": [
                      "localhost:9100"
                    ]
                  }
                ],
                "metric_relabel_configs": [
                  {
                    "target_label": "vm_instance",
                    "replacement": "${env:HOSTNAME:-missedIt}"
                  },
                  {
                    "source_labels": [
                      "__name__"
                    ],
                    "regex": "node_boot_time_seconds|node_uname_info|node_cpu_seconds_total|node_load1|node_cpu_frequency_hertz|node_mountstats_nfs_operations_request_time_seconds_total|node_mountstats_nfs_operations_requests_total|node_mountstats_nfs_total_read_bytes_total|node_mountstats_nfs_total_write_bytes_total|node_disk_io_time_seconds_total|node_disk_read_bytes_total|node_disk_reads_completed_total|node_disk_writes_completed_total|node_disk_written_bytes_total|node_filesystem_avail_bytes|node_filesystem_size_bytes|node_infiniband_link_downed_total|node_infiniband_physical_state_id|node_infiniband_port_constraint_errors_received_total|node_infiniband_port_constraint_errors_transmitted_total|node_infiniband_port_data_received_bytes_total|node_infiniband_port_data_transmitted_bytes_total|node_infiniband_port_discards_transmitted_total|node_infiniband_port_errors_received_total|node_infiniband_port_transmit_wait_total|node_memory_MemAvailable_bytes|node_memory_MemTotal_bytes|node_network_receive_bytes_total|node_network_transmit_bytes_total|node_vmstat_pgmajfault|node_time_seconds",
                    "action": "keep"
                  }
                ]
              },
              {
                "job_name": "Microsoft-gpu_exporter",
                "scrape_interval": "15s",
                "static_configs": [
                  {
                    "targets": [
                      "localhost:9400"
                    ]
                  }
                ],
                "metric_relabel_configs": [
                  {
                    "target_label": "vm_instance",
                    "replacement": "${env:HOSTNAME:-missedIt}"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "destinations": {
      "monitoringAccounts": [
        {
          "accountResourceId": "/subscriptions/11111111-1111-1111-1111-111111111111/resourceGroups/myrg/providers/Microsoft.Monitor/accounts/myworkspace",
          "name": "myMonAccountDest"
        }
      ]
    },
    "dataFlows": [
      {
        "streams": [
          "Microsoft-PrometheusMetrics"
        ],
        "destinations": [
          "myMonAccountDest"
        ]
      }
    ]
  },
  "location": "somewhere"
}
